(defwidget module_bluetooth []
  (box
    (eventbox
      :onhover "${EWW_CMD} update HOVER_BLUETOOTH=true &"
      :onhoverlost "${EWW_CMD} update HOVER_BLUETOOTH=false SHOW_BLUETOOTH=false &"

      (box
        :orientation "v"
        :halign "center"
        :valign "center"
        :space-evenly false
        :spacing 10

        ;; Top box
        (box
          :halign "center"
          :valign "center"
          :space-evenly false
          :spacing 10

          ;; Right
          (revealer
            :transition "slideright"
            :reveal {HOVER_BLUETOOTH == false}
            :duration "200ms"

            (box
              :class "bluetooth_status"
              :width {round(DP_WIDTH / 38.4, 0)}
              :height {round(DP_WIDTH / 38.4, 0)}
              
              (label
                :class "icon"
                :text {BLUETOOTH_CON_STATUS == "connected" ?
                "󰋋"
                :
                "󰟎"
                }
              )
            )
          )

          ;; Center
          (eventbox
            :class "bluetooth_button_rect"
            :onclick "scripts/bluetooth.sh --toggle"

            (box
              :width {round(DP_WIDTH / 7.1, 0)}
              :height {round(DP_WIDTH / 38.4, 0)}

              (label
                :class "label"
                :limit-width 20
                :text {BLUETOOTH_CON_STATUS == "connected" ?
                "${BLUETOOTH_DEVICENAME}"
                :
                "offline"
                }
              )
            )
          )

          ;; Right
          (revealer
            :transition "slideright"
            :reveal HOVER_BLUETOOTH
            :duration "200ms"

            (eventbox
              :class "bluetooth_button_square"
              :onclick "${EWW_CMD} update SHOW_BLUETOOTH=true && scripts/bluetooth.sh --update_eww_json &"
            
              (box
                :width {round(DP_WIDTH / 38.4, 0)}
                :height {round(DP_WIDTH / 38.4, 0)}

                (label :class "icon" :text "󰅂")
              )
            )
          )
        )

        ;; Bottom box
        (revealer
          :transition "slidedown"
          :reveal SHOW_BLUETOOTH
          :duration "200ms"

          (box
            :class "bluetooth_devicename_entry"
            :halign "center"
            :valign "center"
            :width {round(DP_WIDTH / 5.4, 0)}
            :height {round(DP_HEIGHT / 6, 0)}

            (scroll
              :hscroll false
              :vscroll true
              :vexpand true

              (box
                :orientation "v"
                :halign "center"
                :valign "center"
                :space-evenly false
                :spacing 10

                (for entry in BT_NAME_ARRAY
                  (eventbox
                    :class "bluetooth_devicename_button"
                    
                    (box
                      :width {round(DP_WIDTH / 6, 0)}
                      :height {round(DP_WIDTH / 38.4, 0)}
                      
                      (button
                        :onclick "bluetoothctl connect '${entry}'"

                        (label :class "label" :limit-width 20 :text "${entry}")
                      )
                    )
                  )
                )
              )
            )
          )
        )
      )  
    )
  )
)


